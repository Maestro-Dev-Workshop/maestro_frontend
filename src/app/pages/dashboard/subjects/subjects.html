<app-header class="z-10"></app-header>
@if (loadingSubjects) {
  <div class="flex flex-col w-full h-full items-center justify-center absolute z-0 px-4 md:px-8">
    <div class="flex flex-row items-center text-4xl">
      <img src="images/spinner.gif" alt="" class="w-16 h-16 mx-2">
      Loading Subjects...
    </div>
  </div>
} @else {
  @if (subjects.length == 0) {
    <div class="flex flex-col w-full h-full items-center justify-center absolute z-0">
      <h1 class="m-2 text-xl md:text-3xl font-medium">Start Your Learning Journey</h1>
      <p class="w-full md:w-6/12 text-center px-4">Create subjects to keep your study materials neatly categorized and easy to find.</p>
      <button 
        class="rounded-md m-4 md:m-8 px-5 py-3 text-white bg-prussian-blue-800 lg:hover:bg-prussian-blue-500 disabled:bg-prussian-blue-500 flex flex-row justify-center" 
        (click)="createNewSubject()"
        [disabled]="loadingCreate"
      >
        Create New Subject
        <img src="images/create-subject-icon.svg" alt="" class="w-4 ml-2">
      </button>
    </div>
  } @else {
    <div class="flex flex-col w-full px-4 md:px-12 lg:px-32">
      <!-- Heading -->
      <div class="flex flex-row w-full justify-between my-4 space-y-4 md:space-y-0">
        <div class="flex flex-row items-center">
          <img src="images/subject-icon.svg" alt="" class="w-4 mx-4">
          <span class="font-medium text-prussian-blue-900">My Subjects</span>
        </div>
        <button 
          class="w-max rounded-md px-5 py-3 text-white bg-prussian-blue-800 lg:hover:bg-prussian-blue-500 disabled:bg-prussian-blue-500 flex flex-row justify-center text-xs" 
          (click)="createNewSubject()"
          [disabled]="loadingCreate"
        >
          Create New Subject
          <img src="images/create-subject-icon.svg" alt="" class="w-4 ml-2">
        </button>
      </div>
  
      <!-- Subjects List -->
      <div class="w-full h-full flex flex-wrap items-center justify-center px-4">
        @for (subject of subjects; track subject.id) {
          <!-- Subjects Item -->
          <button 
            class="relative flex flex-col justify-between overflow-hidden rounded-lg w-full sm:w-56 h-28 p-4 m-4 bg-prussian-blue-150 lg:hover:bg-prussian-blue-200 lg:hover:top-2"
            (click)="navigateSubject(subject)"
            (contextmenu)="onSubjectRightClick($event, subject)"
          >
            <div class="flex flex-row justify-between items-center">
              <span class="font-medium text-prussian-blue-900">
                @if (subject.name) {
                  {{subject.name}}
                } @else {
                  <em class="font-bold">Untitled</em>
                }
              </span>
              <span [class]="`text-xs py-1 px-3 rounded-full ${getStatusColours(subject.status)}`">
                {{(subject.status.toLowerCase() != "in progress" && subject.status.toLocaleLowerCase() != "completed") ? "Setup Incomplete" : subject.status}}
              </span>
            </div>
            <div class="flex flex-row w-full items-center">
              <!-- Progress Bar -->
              <div class="w-full">
                <div class="w-11/12 h-1 bg-gray-300 rounded-full">
                  <div class="h-full bg-prussian-blue-800 rounded-full" [ngStyle]="{ width: subject.completion*100 + '%' }"></div>
                </div>
              </div>
              <span>{{(subject.completion*100).toFixed(0)}}%</span>
            </div>
          </button>
        }
      </div>

      <!-- Feedback Button -->
      <a 
        href="https://forms.gle/y6B3ReSJXCstUAE89" 
        target="_blank"
        class="absolute bottom-4 left-4 lg:bottom-8 lg:left-8 rounded-full bg-prussian-blue-200 lg:hover:bg-prussian-blue-250 p-3 lg:p-4"
      >
        <!-- <img src="images/feedback.png" alt="" class="w-6 lg:w-8">  -->
        <img src="images/chat-popup-icon.svg" alt="" class="w-6 lg:w-8"> 
      </a>
    </div>
  }
}

<!-- Popup Delete button -->
@if (rightClickSubject) {
  <div 
    [class]="`fixed p-1 bg-white rounded-md flex flex-col items-center justify-center top-[${popup.y}px] left-[${popup.x}px]`"
    [style.top.px]="popup.y + 8"
    [style.left.px]="popup.x + 8"
  >
    <button class="rounded-md px-2 py-1 text-white bg-red-600 lg:hover:bg-red-400" (click)="openDelete()">
      Delete
    </button>
  </div>
}