<app-header></app-header>
<div class="flex flex-col w-full px-12 md:px-32">
  <div class="flex flex-row mb-8 w-full">
    <app-creation-step-tab
      [text]="'My Subject and Materials'"
      [icon]="'images/subject-icon.svg'"
      [active]="true"
      class="hidden md:block w-2/6"
    />
    <app-creation-step-tab
      [text]="'Lesson Content Generation'"
      [icon]="'images/lesson-generation-icon.svg'"
      [active]="true"
      class="hidden md:block w-2/6"
    />
    <app-creation-step-tab
      [text]="'Practice Question Generation'"
      [icon]="'images/question-generation-icon.svg'"
      [active]="true"
      class="w-full md:w-2/6"
    />
  </div>

  <h1 class="text-2xl mb-2 font-medium">Set Practice Questions</h1>
  <p class="mb-4 text-gray-600">
    You can choose to generate practice exercises as well as an exam alongside the lesson.
  </p>

  <form #form="ngForm" class="flex flex-col md:flex-row justify-between w-full my-4">
    <!-- Exercise Form -->
    <div class="flex flex-col w-full md:w-2/4 mb-8 md:mb-0">
      <h1 class="text-2xl">Exercises</h1>
      <!-- Include Exercises -->
      <label class="my-2">Do you want to include exercises for each topic?</label>
      <div>
        <input type="radio" name="include-exercise" id="exercise-yes" class="m-2 accent-blue-900" [value]="true" [(ngModel)]="exerciseSettings.include" [disabled]="loading">
        <label for="exercise-yes">Yes</label>
      </div>
      <div>
        <input type="radio" name="include-exercise" id="exercise-no" class="m-2 accent-blue-900" [value]="false" [(ngModel)]="exerciseSettings.include" [disabled]="loading">
        <label for="exercise-no">No</label>
      </div>

      <!-- Exercise Question Types -->
      <label class="my-2">What question types do you want for the exercise?</label>
      <div>
        <input type="checkbox" id="exercise-mc" class="m-2 accent-blue-900" [disabled]="!exerciseSettings.include || loading" value="multiple choice" (change)="toggleExerciseType($event)">
        <label for="exercise-mc">Single Choice</label>
      </div>
      <div>
        <input type="checkbox" id="exercise-ms" class="m-2 accent-blue-900" [disabled]="!exerciseSettings.include || loading" value="multiple selection" (change)="toggleExerciseType($event)">
        <label for="exercise-ms">Multiple Choice</label>
      </div>
      <div>
        <input type="checkbox" id="exercise-ess" class="m-2 accent-blue-900" [disabled]="!exerciseSettings.include || loading" value="essay" (change)="toggleExerciseType($event)">
        <label for="exercise-ess">Essay</label>
      </div>
      
      <div class="w-full flex flex-col">
        <!-- Exercise Question Count -->
        <div>
          <label for="" class="my-2">Number of questions:</label>
          <input 
            type="number" 
            name="exerciseCount" 
            class="bg-gray-50 p-2 rounded-lg border border-2 text-sm w-12 mx-4" 
            [disabled]="!exerciseSettings.include || loading"
            [(ngModel)]="exerciseSettings.numQuestions"
            [required]="exerciseSettings.include"
            min="1"
            [max]="maxExerciseQuestions"
          >
        </div>

        <!-- Exercise Preference -->
        <div>
          <label class="my-2">(optional) How would you like the exercises to be?</label>
          <textarea
          type="text" 
          name="exercisePreference" 
          placeholder="Input your custom instructions for exercise generation here." 
          class="bg-gray-50 p-4 rounded-lg border border-2 h-32 text-sm w-11/12" 
          [(ngModel)]="exerciseSettings.preference"
          [disabled]="!exerciseSettings.include || loading"
          #exercisePreferenceCtrl="ngModel"
          exercisePreference
          appPreferenceValidator
          ></textarea>
          @if (exercisePreferenceCtrl.invalid && exercisePreferenceCtrl.touched) {
            <div class="text-red-500 text-sm mt-1">
              <!-- @if (exercisePreferenceCtrl.errors?.['required']) {<span>Exercise Preference cannot be empty</span>} -->
              @if (exercisePreferenceCtrl.errors?.['invalidPreference']) {<span>Exercise Preference cannot be longer than 1000 characters</span>}
            </div>
          }
        </div>
      </div>
    </div>
    
    <!-- Exam Form -->
    <div class="flex flex-col w-full md:w-2/4">
      <h1 class="text-2xl">Exam</h1>
      <!-- Include Exam -->
      <label class="my-2">Do you want to include an exam for the lesson?</label>
      <div>
        <input type="radio" name="include-exam" id="exam-yes" class="m-2 accent-blue-900" [value]="true" [(ngModel)]="examSettings.include" [disabled]="loading">
        <label for="exam-yes">Yes</label>
      </div>
      <div>
        <input type="radio" name="include-exam" id="exam-no" class="m-2 accent-blue-900" [value]="false" [(ngModel)]="examSettings.include" [disabled]="loading">
        <label for="exam-no">No</label>
      </div>

      <!-- Exam Question Types -->
      <label class="my-2">What question types do you want for the exam?</label>
      <div>
        <input type="checkbox" id="exam-mc" class="m-2 accent-blue-900" [disabled]="!examSettings.include || loading" value="multiple choice" (change)="toggleExamType($event)">
        <label for="exam-mc">Single Choice</label>
      </div>
      <div>
        <input type="checkbox" id="exam-ms" class="m-2 accent-blue-900" [disabled]="!examSettings.include || loading" value="multiple selection" (change)="toggleExamType($event)">
        <label for="exam-ms">Multiple Choice</label>
      </div>
      <div>
        <input type="checkbox" id="exam-ess" class="m-2 accent-blue-900" [disabled]="!examSettings.include || loading" value="essay" (change)="toggleExamType($event)">
        <label for="exam-ess">Essay</label>
      </div>
      
      <div class="w-full flex flex-col">
        <!-- Exam Question Count -->
        <div>
          <label for="" class="my-2">Number of questions:</label>
          <input 
            type="number" 
            name="examCount" 
            class="bg-gray-50 p-2 rounded-lg border border-2 text-sm w-12 mx-4" 
            [disabled]="!examSettings.include || loading"
            [(ngModel)]="examSettings.numQuestions"
            [required]="examSettings.include"
            min="1"
            [max]="maxExamQuestions"
          >
        </div>

        <!-- Exam Preference -->
        <div>
          <label class="my-2">(optional) How would you like the exam to be?</label>
          <textarea
            type="text" 
            name="examPreference" 
            placeholder="Input your custom instructions for exam generation here." 
            class="bg-gray-50 p-4 rounded-lg border border-2 h-32 text-sm w-11/12" 
            [(ngModel)]="examSettings.preference"
            [disabled]="!examSettings.include || loading"
            #examPreferenceCtrl="ngModel"
            examPreference
            appPreferenceValidator
          ></textarea>
          @if (examPreferenceCtrl.invalid && examPreferenceCtrl.touched) {
            <div class="text-red-500 text-sm mt-1">
              <!-- @if (examPreferenceCtrl.errors?.['required']) {<span>Exam Preference cannot be empty</span>} -->
              @if (examPreferenceCtrl.errors?.['invalidPreference']) {<span>Exam Preference cannot be longer than 1000 characters</span>}
            </div>
          }
        </div>
      </div>
    </div>
  </form>

  <!-- Submit Button -->
  <div class="flex flex-row items-center">
    <button
      type="submit" 
      class="w-max bg-prussian-blue-800 hover:bg-prussian-blue-500 disabled:bg-prussian-blue-500 text-white flex flex-row items-center px-5 py-3 rounded-md text-sm my-4" 
      (click)="onSubmit()"
      [disabled]="loading"
    >
      Next
      <img src="images/next-icon.svg" alt="" class="w-3 ml-2">
    </button>
    <div [class]="`flex flex-row items-center ${loading ? '' : 'hidden'}`">
      <img src="images/spinner.gif" alt="" class="w-8 h-8 mx-2">
      loading...
    </div>
  </div>
</div>