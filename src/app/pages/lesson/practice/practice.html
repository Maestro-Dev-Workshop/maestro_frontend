<div class="p-4 w-full flex flex-col">
  <h1 class="mx-4 mt-4 text-2xl font-medium">
    Question {{getQuestionNumber()}}
  </h1>
  <div class="w-full p-4">
    <h2 class="prose mb-2 text-gray-800" [innerHTML]="question.text | markdown"></h2>
    @if (question.type === 'essay') {
      <textarea
        class="w-full p-2 text-gray-600 border-b-2 border-gray-300 resize-none overflow-hidden focus:outline-none focus:border-b-2 focus:border-prussian-blue-800"
        rows="1"
        placeholder="Type your answer here..."
        [(ngModel)]="question.essay_answer"
        oninput="this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px';"
        onmousemove="this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px';"
        [disabled]="!(currentView().content.score == null) || loading"
      ></textarea>
      @if (currentView().content.score) {
        <div class="w-full my-2 text-gray-500">
          <strong><em>Feedback: </em></strong>
          <span class="prose" [innerHTML]="question.essay_feedback | markdown"></span>
        </div>
      }
    } @else {
      @for (option of question.options; track option.id) {
        <div class="flex flex-row">
          <input 
            [type]="`${question.type === 'multiple choice' ? 'radio' : 'checkbox'}`" 
            [name]="question.id" 
            [id]="option.id" 
            class="m-2 accent-blue-900 cursor-pointer" 
            [value]="option.id"
            [checked]="option.selected"
            (change)="toggleSelectOption(option.id)"
            [disabled]="!(currentView().content.score == null) || loading"
          >
          <label 
            [for]="option.id" 
            [class]="`prose text-gray-600 cursor-pointer
            ${!(currentView().content.score == null) ? (option.correct ? 'text-green-600' : (option.selected? 'text-red-600' : '')) : ''}`"
            [innerHTML]="option.text | markdown"
            >
          </label>
        </div>
        @if (!(currentView().content.score == null)) {
          <div class="w-full my-1 text-gray-500">
            <strong><em><span class="prose" [innerHTML]="option.explanation | markdown"></span></em></strong>
          </div>
        }
      }
    }
  </div>
  
  <!-- Question Navigation -->
  <div class="flex flex-row">
    <button class="flex flex-row items-center mx-4 text-prussian-blue-900 hover:text-prussian-blue-500" (click)="cycleQuestion('prev')">
      <img src="images/dropdown-icon-closed.svg" alt="" class="w-2 m-4 rotate-180">
      Previous
    </button>
    <button class="flex flex-row items-center mx-4 text-prussian-blue-900 hover:text-prussian-blue-500" (click)="cycleQuestion('next')">
      Next
      <img src="images/dropdown-icon-closed.svg" alt="" class="w-2 m-4">
    </button>
  </div>

  <!-- Submission Button -->
  <div class="flex flex-row items-center">
    <button 
      class="self-start w-max text-sm text-white bg-prussian-blue-800 m-4 px-12 py-3 rounded-lg hover:bg-prussian-blue-500 disabled:bg-prussian-blue-500 transition duration-100" 
      (click)="submitAnswers()"
      [disabled]="loading || !(currentView().content.score == null)"
    >
      Submit
    </button>
    <div [class]="`flex flex-row items-center ${loading ? '' : 'hidden'}`">
      <img src="images/spinner.gif" alt="" class="w-8 h-8 mx-2">
      loading...
    </div>
  </div>
</div>
