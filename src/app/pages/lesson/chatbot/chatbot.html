<div class="flex flex-col justify-end h-full w-full bg-white border-l-2 p-2">
  <!-- Close Button -->
  <button class="absolute top-2 justify-self-start p-3 rounded-full bg-prussian-blue-800 hover:bg-prussian-blue-500" (click)="onCloseChat()">
    <img src="images/x-icon.svg" alt="">
  </button>

  <!-- Chat Messages -->
  <div #chatContainer class="flex flex-col w-full flex-grow overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 hover:scrollbar-thumb-gray-500">
    @for (chat of chatHistory(); track $index) {
      <div 
        [class]="`rounded-2xl p-3 my-1 break-words text-sm 
          ${(chat.sender === 'user') 
            ? 'self-end bg-prussian-blue-800 text-white rounded-br-none' 
            : 'prose prose-math self-start bg-gray-100 text-gray-900 rounded-bl-none'}`"
        style="max-width: 80%;"
      >
      <span [innerHTML]="chat.message | markdown"></span>
      </div>
    }
  </div>

  <!-- Text Input -->
  <div class="w-full flex flex-col place-self-end">
    <textarea 
      class="p-2 my-2 border-2 rounded-md overflow-hidden w-full"
      rows="1"
      [(ngModel)]="currentMessage"
      [disabled]="loading"
      (keydown)="handleKeyDown($event)"
      oninput="this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px';"
      onmousemove="this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px';"
    ></textarea>

    <!-- Submit Button -->
    <button 
      class="self-center w-2/4 text-white rounded-md p-2 bg-prussian-blue-800 lg:hover:bg-prussian-blue-500 disabled:bg-prussian-blue-500" 
      (click)="sendMessage()"
      [disabled]="loading || !currentMessage"
    >
      Send
    </button>
  </div>

  <img src="images/spinner.gif" alt="" class="absolute bottom-3 right-2 h-8 mx-2" [hidden]="!loading">
</div>